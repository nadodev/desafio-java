<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{layout/head :: head}"></div>
<body>
<div th:replace="~{layout/header :: header}"></div>
<section th:fragment="content" class="home">
    <div class="container">
       <h1 class="title">Create New Team</h1>
        <form th:action="@{/persons/update}" th:object="${person}" method="post" class="form">
            <input type="hidden" th:field="*{id}"/>

            <div th:if="${errorMessage}" th:text="${errorMessage}" style="color: red;"></div>

            <label for="name">Name:</label>
            <input type="text" id="name" th:field="*{name}" required/><br/>

            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" th:field="*{cpf}" required/><br/>

            <label for="birthDate">Birth Date:</label>
            <input type="date" id="birthDate" th:field="*{birth_date}" required/><br/>

            <label for="phone">Phone:</label>
            <input type="text" id="phone" th:field="*{phone}" required/><br/>

            <label for="email">Email:</label>
            <input type="email" id="email" th:field="*{email}" required/><br/>

            <label for="team">Team:</label>
            <select id="team" th:field="*{team}" required>
                <option value="">Select a team</option>
                <option th:each="team : ${teams}" th:value="${team.id}" th:text="${team.name}"></option>
            </select><br/>
            <label for="educationFields">Education Level:</label>
            <div id="educationFields">
                <!-- Render existing education levels -->
                <div th:each="education : ${person.educations}">
                    <select name="educationLevelNames" required>
                        <option th:value="${education.level.name()}" th:text="${education.level.displayName}" selected></option>
                    </select>
                    <button type="button" onclick="removeEducationField(this)">Remove</button>
                </div>
            </div>

            <button type="button" onclick="addEducationField()">Add Education</button><br/>
            <button type="submit">Update</button>
        </form>


   </div>
</section>
<script>
    function cpf(v) {
        v = v.replace(/\D/g, "")
        v = v.replace(/(\d{3})(\d)/, "$1.$2")
        v = v.replace(/(\d{3})(\d)/, "$1.$2")
        v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2")
        return v
    }
    function phone(v) {
        v = v.replace(/\D/g, "");
        v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
        v = v.replace(/(\d{5})(\d)/, "$1-$2");
        return v;
    }
    function applyCpfMask(event) {
        event.target.value = cpf(event.target.value);
    }
    function applyPhoneMask(event) {
        event.target.value = phone(event.target.value);
    }
</script>
<script>
    function addEducationField() {
        const container = document.getElementById('educationFields');
        const newField = document.createElement('div');
        newField.innerHTML = `
                <select name="educationLevelNames" required>
                    <option value="">Select a level</option>
                    <option th:each="level : ${educationLevels}"
                            th:value="${level.name()}"
                            th:text="${level.displayName}"></option>
                </select>
                <button type="button" onclick="removeEducationField(this)">Remove</button>
            `;
        container.appendChild(newField);
    }

    function removeEducationField(button) {
        const container = document.getElementById('educationFields');
        container.removeChild(button.parentElement);
    }
</script>
</body>
</html>